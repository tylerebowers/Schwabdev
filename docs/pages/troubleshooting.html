
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>troubleshooting</title>
    <link rel="stylesheet" href="../lib/pages.css">
    <link rel="stylesheet" href="../lib/code.css">
</head>
<body>
<h2>Common Issues</h2>
<p>For issues not shown here, please ask in the <a target="_blank" href="https://discord.gg/m7SSjr9rs9">Discord server</a>.</p>
<ul>
<li>
<p><code>{'errors': [{'id': 'XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX', 'status': 401, 'title': 'Unauthorized', 'detail': 'Client not authorized'}]}</code></p>
<ul>
<li><strong>Cause:</strong> You do not have access to both APIs and are attempting to access one that you have not added to your app.</li>
<li><strong>Fix:</strong> Add both APIs <strong>"Accounts and Trading Production"</strong> and <strong>"Market Data Production"</strong> to your app.</li>
<li><strong>Cause:</strong> The access token is expired; sometimes Schwab invalidates tokens when they make backend changes.</li>
<li><strong>Fix:</strong> Manually update the access token by calling <code>client.tokens.update_tokens(force_access_token=True)</code>.</li>
</ul>
</li>
<li>
<p><code>"We are unable to complete your request. Please contact customer service for further assistance."</code> or <code>"Whitelabel Error Page This application has no configured error view, so you are seeing this as a fallback." (status=500)</code></p>
<ul>
<li><strong>Fix:</strong> Your app is <strong>"Approved - Pending"</strong>, you must wait for status <strong>"Ready for Use"</strong>.</li>
<li><strong>Note:</strong> Or you <em>could</em> have an account type that is not supported by the Schwab API.</li>
</ul>
</li>
<li>
<p><code>SSL: CERTIFICATE_VERIFY_FAILED - self-signed certificate in certificate chain</code> </p>
<ul>
<li><strong>Fix:</strong> For macOS you must run the Python certificates installer:</li>
<li><code>open /Applications/Python\ 3.12/Install\ Certificates.command</code></li>
</ul>
</li>
<li>
<p>Issues with certain symbols (streaming/api), e.g:<code>{'errors': [{'id': 'f00192c6-155b-4cd6-b1ac-f11d7cb91962', 'status': '404', 'title': 'Not Found'}]}</code> </p>
<ul>
<li><strong>Cause:</strong> The symbol you are using is in an invalid format or not found</li>
<li><strong>Fix:</strong> Indexes require a <code>$</code> prefix (e.g. <code>$SPX</code>, <code>$DJI</code>).</li>
<li><strong>Fix:</strong> Option contract:<ul>
<li><code>Symbol (6 characters including spaces) | Expiration (6 characters) | Call/Put (1 character) | Strike Price (5+3=8 characters)</code></li>
<li>Expiration is in <code>YYMMDD</code> format.</li>
<li>e.g. <code>"AAPL  240517P00190000"</code>, <code>"AAPL  251219C00200000"</code></li>
</ul>
</li>
<li><strong>Fix:</strong> Futures:<ul>
<li><code>'/' + 'root symbol' + 'month code' + 'year code'</code></li>
<li>Month code is 1 character: <code>F: Jan, G: Feb, H: Mar, J: Apr, K: May, M: Jun, N: Jul, Q: Aug, U: Sep, V: Oct, X: Nov, Z: Dec</code></li>
<li>Year code is 2 characters (i.e. 2024 â†’ <code>24</code>).</li>
</ul>
</li>
<li><strong>Fix:</strong> Futures Options:<ul>
<li><code>'.' + '/' + 'root symbol' + 'month code' + 'year code' + 'Call/Put (1 char)' + 'Strike Price'</code></li>
<li>Month code is 1 character (same mapping as futures).</li>
<li>Year code is 2 characters (i.e. 2024 â†’ <code>24</code>).</li>
</ul>
</li>
<li><strong>Fix</strong> Make sure the symbol can be found on Schwab's platform (i.e. TOS)</li>
</ul>
</li>
<li>
<p><code>{"error":"unsupported_token_type","error_description":"400 Bad Request: \"{\"error_description\":\"Exception while authenticating refresh token..."</code></p>
<ul>
<li><strong>Cause:</strong> Your refresh token is invalid (maybe you created a new refresh token on a different machine).</li>
<li><strong>Fix:</strong> Manually update the refresh token by changing the date in <code>tokens.json</code> or by calling <code>client.tokens.update_tokens(force=True)</code>.</li>
</ul>
</li>
<li>
<p><code>"can't register atexit after shutdown"</code></p>
<ul>
<li><strong>Cause:</strong> The main thread dies before the stream thread starts.</li>
<li><strong>Fix:</strong> Add a delay after starting or sending a request â€” something to let the stream thread start up before the main thread closes.</li>
</ul>
</li>
<li>
<p>After signing in, you get an <strong>"Access Denied"</strong> web page.</p>
<ul>
<li><strong>Fix:</strong> Your callback URL is likely incorrect due to a trailing slash <code>/</code> at the end.</li>
</ul>
</li>
<li>
<p>App Registration Error</p>
<ul>
<li><strong>Fix:</strong> Email Schwab: <code>traderapi@schwab.com</code></li>
</ul>
</li>
<li>
<p>Issue in streaming with websockets â€“</p>
<ul>
<li><code>"Unsupported extension: name = permessage-deflate, params = []"</code></li>
<li><strong>Cause:</strong> You are using a proxy that is blocking streaming or your DNS is not correctly resolving.</li>
<li><strong>Fix:</strong> Change DNS servers (Googleâ€™s are known-working) or change/bypass the proxy.</li>
</ul>
</li>
<li>
<p><code>{'fault': {'faultstring': 'Body buffer overflow', 'detail': {'errorcode': 'protocol.http.TooBigBody'}}}</code></p>
<ul>
<li><strong>Cause:</strong> The call that you made exceeds the amount of data that can be returned.</li>
<li><strong>Example:</strong> The call <code>print(client.option_chains("$SPX").json())</code> returns too much data and will exceed the buffer size.</li>
<li><strong>Fix:</strong> Add additional parameters to limit the amount of data returned.</li>
</ul>
</li>
<li>
<p>Refresh token expiring in 7 days is too short.</p>
<ul>
<li><strong>Fix:</strong> <em>I know.</em> ðŸ˜…</li>
</ul>
</li>
</ul>
<hr />
</body>
</html>
    