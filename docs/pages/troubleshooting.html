
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>troubleshooting</title>
    <link rel="stylesheet" href="../lib/pages.css">
    <link rel="stylesheet" href="../lib/code.css">
</head>
<body>
<h2>Common Issues</h2>
<ul>
<li>
<p><code>{'errors': [{'id': 'XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX', 'status': 401, 'title': 'Unauthorized', 'detail': 'Client not authorized'}]}</code></p>
<ul>
<li><strong>Cause:</strong> You do not have access to both APIs and are attempting to access one that you have not added to your app.</li>
<li><strong>Fix:</strong> Add both APIs <strong>"Accounts and Trading Production"</strong> and <strong>"Market Data Production"</strong> to your app.</li>
<li><strong>Cause:</strong> The access token is expired; sometimes Schwab invalidates tokens when they make backend changes.</li>
<li><strong>Fix:</strong> Manually update the access token by changing the date in <code>tokens.json</code> or update both tokens by calling <code>client.tokens.update_tokens(force=True)</code>.</li>
</ul>
</li>
<li>
<p><code>"We are unable to complete your request. Please contact customer service for further assistance."</code></p>
</li>
<li>
<p><code>"Whitelabel Error Page This application has no configured error view, so you are seeing this as a fallback." (status=500)</code></p>
<ul>
<li><strong>Fix:</strong> Your app is <strong>"Approved - Pending"</strong>, you must wait for status <strong>"Ready for Use"</strong>.</li>
<li><strong>Note:</strong> Or you <em>could</em> have an account type that is not supported by the Schwab API.</li>
</ul>
</li>
<li>
<p><code>SSL: CERTIFICATE_VERIFY_FAILED - self-signed certificate in certificate chain</code> error when connecting to streaming server</p>
<ul>
<li><strong>Fix:</strong> For macOS you must run the Python certificates installer:</li>
<li><code>open /Applications/Python\ 3.12/Install\ Certificates.command</code></li>
</ul>
</li>
<li>
<p>Issues with option contracts in API calls or streaming</p>
<ul>
<li><strong>Fix:</strong> You are likely not following the format for option contracts.</li>
<li><strong>Option contract format:</strong></li>
<li><code>Symbol (6 characters including spaces) | Expiration (6 characters) | Call/Put (1 character) | Strike Price (5+3=8 characters)</code></li>
</ul>
</li>
<li>
<ul>
<li><code>{"error":"unsupported_token_type","error_description":"400 Bad Request: \"{\"error_description\":\"Exception while authenticating refresh token..."</code></li>
</ul>
</li>
<li>
<p><code>"Could not get new access token (1 of 3)."</code> (or x of 3 etc.)</p>
<ul>
<li><strong>Cause:</strong> Your refresh token is invalid (maybe you created a new refresh token on a different machine).</li>
<li><strong>Fix:</strong> Manually update the refresh token by changing the date in <code>tokens.json</code> or by calling <code>client.tokens.update_tokens(force=True)</code>.</li>
</ul>
</li>
<li>
<p><code>"can't register atexit after shutdown"</code></p>
<ul>
<li><strong>Cause:</strong> The main thread dies before the stream thread starts.</li>
<li><strong>Fix:</strong> Add a delay after starting or sending a request â€” something to let the stream thread start up before the main thread closes.</li>
</ul>
</li>
<li>
<p>API calls throwing errors despite access token and refresh token being valid / not expired.</p>
<ul>
<li><strong>Fix:</strong> Manually update refresh / access tokens by calling <code>client.tokens.update_tokens(force=True)</code>; you can also delete the <code>tokens.json</code> file.</li>
</ul>
</li>
<li>
<p>Streaming <code>ACCT_ACTIVITY</code> yields no responses.</p>
<ul>
<li><strong>Fix:</strong> This is a known issue on Schwab's end.</li>
</ul>
</li>
<li>
<p>After signing in, you get an <strong>"Access Denied"</strong> web page.</p>
<ul>
<li><strong>Fix:</strong> Your callback URL is likely incorrect due to a trailing slash <code>/</code> at the end.</li>
</ul>
</li>
<li>
<p>App Registration Error</p>
<ul>
<li><strong>Fix:</strong> Email Schwab: <code>traderapi@schwab.com</code></li>
</ul>
</li>
<li>
<p>Issue in streaming with websockets â€“</p>
<ul>
<li><code>"Unsupported extension: name = permessage-deflate, params = []"</code></li>
<li><strong>Cause:</strong> You are using a proxy that is blocking streaming or your DNS is not correctly resolving.</li>
<li><strong>Fix:</strong> Change DNS servers (Googleâ€™s are known-working) or change/bypass the proxy.</li>
</ul>
</li>
<li>
<ul>
<li><code>{'fault': {'faultstring': 'Body buffer overflow', 'detail': {'errorcode': 'protocol.http.TooBigBody'}}}</code></li>
<li><strong>Cause:</strong> The call that you made exceeds the amount of data that can be returned.</li>
<li><strong>Example:</strong> The call <code>print(client.option_chains("$SPX").json())</code> returns too much data and will exceed the buffer size.</li>
<li><strong>Fix:</strong> Add additional parameters to limit the amount of data returned.</li>
</ul>
</li>
<li>
<p>can't register atexit after shutdown</p>
<ul>
<li><strong>Cause:</strong> The main thread dies before the stream thread starts.</li>
<li><strong>Fix:</strong> Add a delay after starting or sending a request â€” something to let the stream thread start up before the main thread closes.</li>
</ul>
</li>
<li>
<p>Refresh token expiring in 7 days is too short.</p>
<ul>
<li><strong>Fix:</strong> <em>I know.</em> ðŸ˜…</li>
</ul>
</li>
</ul>
<hr />
<p>For issues not shown here, please ask in the <a href="https://discord.gg/m7SSjr9rs9">Discord</a> server.</p>
</body>
</html>
    